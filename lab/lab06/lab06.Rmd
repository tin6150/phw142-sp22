---
title: 'Lab 6: Normal, Binomial, and Poisson Distribution'
author: "tin ho 3033518549"
date: "3/13/2022"
output: pdf_document
---

```{r}
library(testthat)
library(dplyr)
library(ggplot2)
library(rlang)
```
 
### Instructions
* Due date: Monday March 14th at 11:59pm PST.
* Late penalty: 50% late penalty if submitted within 24 hours of due date, no 
marks for assignments submitted thereafter.
* This assignment is graded on **correct completion**, all or nothing. You must pass all public tests and submit the assignment for credit.
* Submission process: Follow the submission instructions on the final page. Make sure you do not remove any `\newpage` tags or rename this file, as this will break the submission. 

Helpful hints:

- Every function you need to use was taught during lecture! So you may need to 
revisit the lecture code to help you along by opening the relevant files on Datahub. 
Alternatively, you may wish to view the code in the condensed PDFs posted 
on the course website. Good luck!

- Knit your file early and often to minimize knitting errors! If you copy and 
paste code for the slides, you are bound to get an error that is hard to 
diagnose. Typing out the code is the way to smooth knitting! We recommend 
knitting your file each time after you write a few sentences/add a new code 
chunk, so you can detect the source of knitting errors more easily. This will 
save you and the GSIs from frustration! **You must knit correctly before submitting.**

- If your code runs off the page of the knitted PDF then you will LOSE POINTS! To
avoid this, have a look at your knitted PDF and ensure all the code fits in the 
file (you can easily view it on Gradescope via the provided link after submitting). 
If it doesn't look right, go back to your .Rmd file and add spaces (new lines) using
the return or enter key so that the code runs onto the next line.

\newpage

### Introduction:

This lab will wrap up some concepts about the Normal distribution. We will then look at the binomial distribution and the normal approximation of the binomial. Finally, we will look at calculations under the Poisson distribution. 



### Part 1: Review Questions

To prepare for this lab, take a minute to answer the following review questions.

**1. What are the two parameters that define the Normal distribution?**

_1. mean/average 2.sigma/standdard deviation.  _

**2. What type(s) of plots can we use to determine if data is approximately normally distributed?**

_QQ Plots_

**3. How can you determine if a random variable follows a binomial distribution?**

_1. Random Variable X has values 0 or 1, Failure or Success, always one or the other, mutually exclusive, and 0,1 space is exhaustive.  Outcomes are independent.  Number of trials is from count, finite size, up to a max. _

**4. How can you determine if a random variable follows a Poisson distribution?**

_1. Random Variable X has values 0 or 1, Failure or Success, always one or the other, mutually exclusive, and 0,1 space is exhaustive.  Outcomes are independent.  HOWEVER, while Number of trials are also from count, they is no upper limit. It is usually for rare events, eg whether a child has Mumps infection.  _

\newpage

### Part 2: More Practice with the Normal Distribution

Eating disorders affect at least 9% of the population worldwide. One such eating disorder is anorexia which affects approximately 1 in 200 American women. One study was interested in the effects of different therapies as forms of treatment for eating disorders. 72 young women were recruited and assigned to 1 of 3 different groups: control, cognitive behavioral treatment (CBT), and family therapy. Their weights (in pounds) were recorded pre-treatment and post-treatment. 

```{r load-data}
# The data comes from an R package called MASS. Let's first load the package.
if (!require("MASS")){
  install.packages("MASS")
}

# Save the dataset in an object called `anorexia`
anorexia <- MASS::anorexia

# MASS has functions with the same names as common dplyr functions
# We will detach it now so that we can continue to use our dplyr functions
detach("package:MASS", unload = T)

head(anorexia, 10) # Here are the first 10 rows of data
str(anorexia)
```



**5. [1 point] Add a new column to `anorexia` called `diff` that is the difference between the women's weights before and after treatment. Assign this new dataset to an object called `anorexia_diff`.**

```{r}
anorexia_diff <- NULL # YOUR CODE HERE
anorexia_diff <- anorexia %>% mutate( diff = Postwt - Prewt)
anorexia_diff
dim(anorexia_diff) # Uncomment this line to check the dimensions of your new dataset
#str(anorexia_diff)

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p5.R")
```

**6. [1 point] Visualize the distribution of the variable `diff`. Choose an appropriate binwidth.**

```{r}
p6 <- NULL # YOUR CODE HERE
p6 <- ggplot( data=anorexia_diff, aes(x=diff)  ) + geom_histogram( binwidth=2 )
p6


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p6.R")
```

**7. Describe the distribution of the `diff` variable.**

_It has some semblance of a normal distribution.  If we had more data points, it may indeed show up as a bell curve.  Mean = peak = 0 ie no weight differences pre and post-treatment.  std dev maybe 4 lbs._

**8. [1 point] Compare the `diff` variable from the `anorexia_diff` data to a Normal distribution using a different `ggplot2` function. Determine if a Normal distribution is a good fit for these data.**

```{r}
p8 <- NULL # YOUR CODE HERE
p8 <- ggplot( data=anorexia_diff, aes(sample=diff)  ) + stat_qq() + stat_qq_line()

p8


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p8.R")
```
_Type your answer here, replacing this text._

**9. [1 point] Assume data on the difference in weights pre- and post-treatment is sampled from a population distribution that is approximately Normal with a mean of 2 pounds and standard deviation of 7 pounds. Find the probability that a randomly chosen woman suffering from anorexia gains 5 pounds or more over the course of the treatment. You may leave this as an unrounded number between 0 and 1.**

```{r}
p9 <- NULL # YOUR CODE HERE
p9 <- pnorm(5,mean=2,sd=7,lower.tail=F)
p9

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p9.R")
```

**10. [1 point] Using the information above, find the number of pounds a randomly chosen woman would need to gain in order to be in the 90th percentile according to this probability distribution.**

```{r}
p10 <- NULL # YOUR CODE HERE
p10 <- qnorm(0.9,mean=2,sd=7)
p10


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p10.R")
```

\newpage

## Section 3: Binomial Distribution and Normal Approximation

**Example from Baldi and Moore**

Antibiotic resistance occurs when disease-causing microbes no longer respond to antibiotic drug therapy. Because such resistance is typically genetic and transferred to the next generations of microbes, it is a very serious public health problem. One such disease with antibiotic resistance is Gonorrhea, the second most commonly reported notifiable disease in the USA. According to the CDC, 27% of Gonorrhea cases tested in 2010 were resistant to at least one of the three major antibiotics commonly used to treat sexually transmitted diseases. For the following examples, consider a physician who treated 20 cases of Gonorrhea in 2010.

**11. Let X represent the number of patients with antibiotic resistance seen by this physician. Use notation you learned in lecture to show the distribution that X follows.**

_X is a Binomial Distribution.  0=no antibiotics resistance, 1=yes on antibiotics resistance. p=.27 for the prop of antibiotic resistance gonorrhea prevalence in 2010.  _

**12. [1 point] Calculate (by hand) the probability that exactly 5 of the 20 treated people have antibiotic resistance. You can use the `choose(n = , k = )` function in R to help. Confirm your results using an R function.**

```{r}
p12 <- NULL # YOUR CODE HERE
# P(X=k) = C(n,k)*(p^k)*(1-p)^(n-k)
k<-5
n<-20
p<-0.27
p12 <- choose(n,k)*(p^k)*(1-p)^(n-k)
p12

confirm <- dbinom(x=5,size=20,prob=0.27)
confirm
p12 - confirm
p12
# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p12.R")
```
_19.82%_

**13. [1 point] Calculate (by hand) the probability that more than 1 person has antibiotic resistance. Confirm your answer using R. Hint: work smarter not harder.**

```{r}
p13 <- NULL # YOUR CODE HERE
p13

# here want P(X>1)  # >1 , NOT >=1  ... sneaky!  
# so, essentially 100% - P(X=0) - P(X=1)

n<-20
p<-0.27
p13 <- 1 - choose(n,0)*(p^0)*(1-p)^(n-0) -
           choose(n,1)*(p^1)*(1-p)^(n-1)
p13

confirm13 <- 1 - pbinom(1,size=20,prob=0.27)
confirm13
p13 - confirm13
p13


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p13.R")
```
_98.45%_

Suppose in one Western United States city there were 812 cases of gonorrhea in a population of 100,000. The probability of antibiotic resistance to at least one major antibiotic remains the same at approximately 27 percent. 

**14. [1 point] Calculate the expected number of antibiotic resistant cases of gonorrhea in this population. Make sure to round to the nearest whole number. Also calculate the standard deviation and round this number to two decimal places. Assign `p14` to a vector of these two values.**

```{r}
p14 <- NULL # YOUR CODE HERE

##gono_resist <- round(qbinom(p=0.5,size=812,prob=0.27),0)   ## nope, not this
p <- 0.27
n_cases <- 812


# from X .~ N(mu=np,sigma=sqrt(np(1-p)))
gono_resist_mean <- round(   n_cases * p, 0 )
gono_resist_sd   <- round( sqrt( (n_cases)*(p)*(1-p)) , 2 )

p14 <- c(gono_resist_mean,gono_resist_sd)
p14


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p14.R")
```

**15. We learned in class that the binomial distribution can be approximated by the Normal distribution under some conditions. List the conditions below and determine whether problem 14 satisfies them.**

_n is large enough, eg n*p>10 AND n*(1-p)>10, and these conditions are satisfied in this example problem 14._

```{r my_scratch}
(n_cases)*(p)
(n_cases)*(1-p)
```


**Let's generate some data from this distribution to check the normal approximation!**

The first step is to generate the probabilities of observing each of the possible values of X ~ Binom(n = 812, p = 0.27). We will use the familiar `dbinom()` function to do this. However, instead of just plugging in one value, we will plug in the entire range of values (0 through 812) and save it as a vector called `obs_data`.

Note: You will not be tested on this use of code but you should understand what's happening at every step. It is useful to print out the object in your console to get an idea of what's happening at each stage.

```{r}
# This is just the range of values x can take
x_vals <- 0:812

# This generates the probabilities
probs <- dbinom(0:812, size = 812, prob = 0.27)

# This combines the range of values with the probabilities as a dataframe with 2 columns: x_vals and probs.
# View(obs_data) in your console to see what this dataframe looks like
obs_data <- as.data.frame(cbind(x_vals, probs))
```

**16. [1 point] Now use ggplot2 to plot a histogram of `obs_data` with `x_vals` on the x-axis and the respective probabilities on the y-axis.**

```{r}

## ref: Lab video ~ [24:00]  
## https://bcourses.berkeley.edu/courses/1513233/pages/week-8

### NOTp16 <- ggplot(data=obs_data,aes(x=x_vals,y=probs)) + geom_histogram( XXbinwidthXX = 1, stat="identity" )

p16 <- ggplot(data=obs_data,aes(x=x_vals,y=probs)) + geom_histogram( stat="identity" )


p16

```

```{r}
. = ottr::check("tests/p16.R")
```

\newpage

## Section 4: Poisson Distribution

**Example from Baldi and Moore**

Between 2006 and 2010, the state of New York reported 1484 live births of infants with Down Syndrome, which averages to about 5.7 cases per week. While the causes of Down Syndrome are not fully understood, it is reasonable to assume that live births are independent and the weekly rate is constant. Let X represent the count of babies born with Down Syndrome in New York in a given week.

**17. What distribution does X approximately follow? Write it using notation learned in lecture. What are the possible values X can take?**

_this looks to follow a poisson dist, as it is 0,1 for no,yes for Down syndrome, and number of cases go be arbitrary large (but pop size is not actually infinite, close enough?).  a finite time span was specified (1wk) and the cases are independent (though the problem did not talk about twins and whether down syndrome for them are independent, let's skip over the devils for this lab?)_

  
**18. [1 point] What are the mean and standard deviation of X? Assign these values to a vector called `p18` with mean as the first value and the standard deviation as the second.**

```{r}
p18 <- NULL # YOUR CODE HERE
down_mean <- 5.7
down_sd   <- sqrt(down_mean)
p18 <- c(down_mean, down_sd)
p18 

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p18.R")
```

**19. [1 point] What is the probability that no child will be born with Down Syndrome in a given week in New York? Calculate the probability by hand and confirm your answer using a function in R.**

```{r}
p19 <- NULL # YOUR CODE HERE

# Poisson P(X=k) = ((e^-mu)*(mu^k))/(k!)

k19   <- 0
mu19  <- 5.7
factorial(0)
5.7^0
exp(-5.7)
exp(-(mu19))
p19 = 0.003345965


poisson19 <-  ( (  exp(-mu19))*(mu19^k19)  ) / factorial(k19)
poisson19

check0 = p19 - poisson19
check0

confirm19 = ppois(0,lambda=mu19)

confirm19 = dpois(0,lambda=mu19)    # for 0 p- and d- class expected to return same result, which it does

confirm19



c(p19,poisson19,confirm19)

check = confirm19 - p19
check

p19

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p19.R")
```

**20. [1 point] What is the probability that 2 or more children will be born with Down Syndrome in a given week in New York? Calculate the probability by hand and confirm your answer in R.**

```{r}

#### ie, want to find P(X>=2) 
#### Lect 17 slide 12.
#### manually... how can one do P(X=2) + P(X=3) + ... + P(X=infinity) ??
#### still do the same that the lecture did, but by hand.  1 - [ P(X=1) + P(X=0) ]



mu20=mu19

PX0 = ( (  exp(-mu20))*(mu20^0)  ) / factorial(0)
PX1 = ( (  exp(-mu20))*(mu20^1)  ) / factorial(1)

poisson20 <-  1 - PX0 - PX1
poisson20



#check00 = p20 - poisson20
#check00

confirm20 = 1- ppois(1,lambda=mu20)
confirm20

check20 = poisson20 - confirm20
check20

p20 = poisson20
p20


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p20.R")
```

**21. [1 point] Use R to calculate the probability that more than 12 children are born with Down Syndrome.**

```{r}
p21 <- NULL # YOUR CODE HERE

## now wants P(X>12)   # more than 12, so 12 isn't included, rigth??
## use complement side... 1 - P(X<=12)

p21 = 1- ppois(12,lambda=mu20)

p21


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p21.R")
```

\newpage

### Submission

For assignments in this class, you'll be submitting using the **Terminal** tab in the pane below. In order for the submission to work properly, make sure that:

1. Any image files you add that are needed to knit the file are in the `src` folder and file paths are specified accordingly. 
2. You **have not changed the file name** of the assignment.
3. The file knits properly.

Once you have checked these items, you can proceed to submit your assignment.

1. Click on the **Terminal** tab in the pane below.
2. Copy-paste the following line of code into the terminal and press enter.

cd; cd phw142-sp22/lab/lab06; python3 turn_in.py

3. Follow the prompts to enter your Gradescope username and password. When entering your password, you won't see anything come up on the screen--don't worry! This is just for security purposes--just keep typing and hit enter.
4. If the submission is successful, you should see "Submission successful!" appear as output.
5. If the submission fails, try to diagnose the issue using the error messages--if you have problems, post on Piazza. 

The late policy will be strictly enforced, **no matter the reason**, including submission issues, so be sure to submit early enough to have time to diagnose issues if problems arise.

