---
title: 'Lab 5: Independence, Screening, and Normal Distribution'
author: "Tin Ho 3033518349"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
---


**Run this chunk of code to load the autograder package!**
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(testthat)
```

### Instructions 
* Due date: Monday, February 28th at 11:59pm PT.  Now 3/7
* Late penalty: 50% late penalty if submitted within 24 hours of due date, no marks for assignments submitted thereafter.
* This assignment is graded on **correct completion**, all or nothing. You must pass all public tests and submit the assignment for credit.
* Submission process: Follow the submission instructions on the final page. Make sure you do not remove any `\newpage` tags or rename this file, as this will break the submission. 

Helpful hints:

- Every function you need to use was taught during lecture! So you may need to 
revisit the lecture code to help you along by opening the relevant files on Datahub. Alternatively, you may wish to view the code in the condensed PDFs posted on the course website. Good luck!

- Knit your file early and often to minimize knitting errors! If you copy and paste code for the slides, you are bound to get an error that is hard to diagnose. Typing out the code is the way to smooth knitting! We recommend knitting your file each time after you write a few sentences/add a new code chunk, so you can detect the source of knitting errors more easily. This will save you and the GSIs from frustration! **You must knit correctly before submitting.**

- If your code runs off the page of the knitted PDF then you will LOSE POINTS! To avoid this, have a look at your knitted PDF and ensure all the code fits in the file (you can easily view it on Gradescope via the provided link after submitting). If it doesn't look right, go back to your .Rmd file and add spaces (new lines) using the return or enter key so that the code runs onto the next line.

\newpage

### Section I: Breakout Problems on Independence

Part 1 of this lab focuses on calculating the probability of independent events.

## Blood Type

**From Baldi and Moore (3E question 10.28, 4E question 10.30)**
All human blood can be one of the following types: O, A, B, or AB, but the distribution of blood types varies a bit among different populations of people. Here are the distributions of blood types for a randomly chosen person in China and in the United States:
  
  |       |  $O$ |  $A$ |  $B$ |  $AB$ | 
  |-------|------|------|------|-------|
  |China  |  0.35|  0.27|  0.26|   0.12| 
  |U.S.   |  0.45|  0.40|  0.11|   0.04|  
  
Choose an American person and a Chinese person at random, and assume they are independent of one other.

**1. [1 point] What is the probability that both have type O blood?**

P(O|C) intersect P(O|U)

  

```{r}
p1 <- NULL # YOUR CODE HERE
p1 = .35 * .45
p1


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p1.R")
```

\newpage

**2. [1 point] What is the probability that both have the same blood type?**
  
  
P(O|C) intersect P(O|U)   + 
P(A|C) intersect P(A|U)   + 
P(B|C) intersect P(B|U)   + 
P(AB|C) intersect P(AB|U)   


```{r}
p2 <- NULL # YOUR CODE HERE
p2 = (.35*.45) + (.27*.4) + (.26*.11) + (.12*.04)
p2

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p2.R")
```

\newpage

**3. From Baldi and Moore (3E question 10.29, 4E not present)**

_Universal blood donors._

People with type O-negative blood are universal donors. That is, any patient can receive a transfusion of type O-negative blood without problems. Only 7.2% of the American population have O-negative blood. If 10 people appear at random to give blood, what is the probability that at least 1 of them is a universal donor?

_It would be 1 - P(zero person out of 10 is universal donor)._

_P(zero person out of 10 is universal donor) is dbinom(x=0, size=10, prob=0.072) , so_

_1 - 0.4736742  = 0.5263258_

_ie 52.63% chance that out of 10 people at least 1 would be universal donor_



```{r}
zero_udon = dbinom(0, size=10, prob=0.072)
answer = 1 - zero_udon
c(answer, 1, zero_udon)

# cuz 0 is the smallest non-negative integer, these 2 are the same:
dbinom(x=0,size=10,prob=0.072)
pbinom(q=0,size=10,prob=0.072)
```
\newpage

**From Baldi and Moore (3E question 10.46, 4E not present)**
  
_Mendelian inheritance._ 

Some traits of plants and animals depend on inheritance of a single gene.  
This is called _Mendelian inheritance_, after Gregor Mendel (1822-1884).
Each of us has an ABO blood type, which classifies human blood based on whether two characteristics, A and B, are present. Every human being has two blood type alleles (gene forms): one inherited from our mother and one from our father. Each of these alleles can be A, B, or O. Which two we inherit determines our blood type. Here is a table that shows what our blood type is for each combination of two alleles.

  |Alleles inherited   | 	Blood type|
  |--------------------|------------|
  |	A and A            |           A|
  |	A and B	           |			    AB|
  |	A and O	           |			     A|
  |	B and B	           |           B|
  |	B and O	           |		    	 B|
  |	O and O	           |     			 O|
  
We inherit each of a parent’s two alleles with probability .50,
and we inherit independently from our mother and our father.

Punnett squares are used in genetics courses to organize this type of information.
The rows represent the alleles for one parent and the columns represent the alleles for the other parent.

**4. Rachel and Jonathan both have alleles A and B. What blood types can their children have?**

_A,B,AB_

\newpage

**5. [1 point] Jasmine has alleles A and O. Tyrone has alleles B and O. What is the probability that a child of these parents has blood type O?**
  
  _It is .5 * .5 so 1/4_

```{r}
p5 <- NULL # YOUR CODE HERE
p5 = .5 * .5
p5


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p5.R")
```

\newpage

*The next calculations assume that Jasmine and Tyrone do not have any twins or triplets, so that each child is independent.*

**6. [1 point] If Jasmine and Tyrone have three children, what is the probability that all three have blood type O?**

```{r}
p6 <- NULL # YOUR CODE HERE
p6 = (.5*.5)^3
p6

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p6.R")
```

**7 [1 point] What is the probability that the first child has blood type O and the next two do not?**

```{r}
p7 <- NULL # YOUR CODE HERE
p7 = 1/4 * (1-1/4) * (1-1/4)
p7

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p7.R")
```

\newpage

## The Flu

**From Baldi and Moore (2E question 10.20 to 10.23)**
  
The November 2009 Gallup-Healthways Well-Being Index survey asked a random sample of 28,606 American adults whether they had the flu on the day before the interview. Here are the results by age group:
  |age group |		flu| 		no flu|	  total|
  |----------|-------|----------|--------|
  | 18 to 29 |		 88|	   2,486|   2,574|
  |	30 to 44 |		132|	   5,162|   5,294|
  |	45 to 64 |		276|		11,733|  12,009|
  |	65+      |	  122|	   8,607|	  8,729|
  |total     |	  618|		27,988|  28,606|
  
The events "adult is in a specified age group" and "adult has the flu" are called **independent** if the probability of flu does not vary across the age groups.

**8. Calculate and compare the conditional probability of flu among those age 65 and older and the conditional probability of flu among those 18 to 29 years old.**

_P(flu|65+)   = 112/8792 =  0.01273885_
_P(flu|18-29) =  88/2574 =  0.03418803_


This shows that the events "age group" and "adult has the flu" are **not** independent.

**Another way to check for independence is to see if the overall probability of flu differs from the age-group stratum specific probabilities of flu. Do this, too.**

_P(flu|anyAge)  = 618/28606 = 0.02160386, which differ from both of the answer above, thus not independetn_


\newpage

## Testing for HIV 

**From Baldi and Moore (question 10.14)**

Enzyme immunoassay tests are used to screen blood specimens for the
presence of antibodies to HIV, the virus that causes AIDS. Antibodies indicate the presence of the virus. The test is quite accurate but is not always correct. Here are approximate probabilities of positive and negative test results when the blood tested does and does not actually contain antibodies to HIV. [Hint: these are conditional probabilities, given HIV status].

* P( test positive + | antibodies present ) = 0.9985  # sensitivity, mostly?
* P( test positive + | antibodies absent ) = 0.0060
* P( test negative – | antibodies present ) = 0.0015 
* P( test negative – | antibodies absent ) = 0.9940   # specificity, mostly 

Suppose that 1% of a large population carries antibodies to HIV in its blood.

**9. Draw a tree diagram representing the HIV status of a person from this population (outcomes: antibodies present or absent) and the blood test result (outcomes: test positive or test negative).**


(Use the code chunk below to include an image file of your drawing. To do so, you need to delete the hashtag, upload the image to Datahub into the `src` directory and replace the file name with your file name. JPG or PNG will both work.)

```{r}
# Take off the '#' in the following code and replace the code with you file name

knitr::include_graphics("src/phw142_lab05_hiv_status.jpg")
```

```{r}
# YOUR CODE HERE
```

\newpage

**10. [1 point] What is the probability that the test is positive for a randomly chosen person from this population?**

1% of pop has HIV Ab in its blood, so 1%  will be Ab+
Out of this, 99.85% of them will test +ve, thus 1% * 99.85%

BUT, still need to add:
99% will be Ab-, but .6% of them will still test +ve.


```{r}
p10 <- NULL # YOUR CODE HERE
p10 = (.01 * 0.9985 ) + (.99*.0060)
p10

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p10.R")
```

\newpage

**From Baldi and Moore (10.16)**
  
**11. [1 point] What is the probability that a person has the antibody, given that the test is positive? Explain in your own words what this means.**



_P(Ab+|T+), which is the PPV value, which is TP / (TP+FP)_
_but don't readily have TP and FP values from the HIV status tree_
_thus need the 1% exptected AB+ rate_

1% of pop has HIV Ab in its blood, so 1%  will be Ab+
Out of this, 99.85% of them will test +ve, thus 1% * 99.85% = 0.009985 <-- this is TP

Now need to find out FP rate:
99% will be Ab-, but .6% of them will still test +ve. thus .99 * .006 = 0.009985 <-- FP

_Overall, PPV comes out to 62.70%, which is to say that widespread test for HIV Ab_
_in this population will find that 62.7% of the people to be Positive and actually have the HIV Ab._

```{r}
p11 <- NULL # YOUR CODE HERE
p11 = 0.9985 / (0.9985 + .0015 )
TP=0.009985
FP=.99 * .006
p11 = TP / (TP+FP)
p11


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p11.R")
```

\newpage

**12. Define and calculate the test's sensitivity, specificity, and positive predictive value.**


_Sensitivity is provided by: P( test positive + | antibodies present ) = 0.9985_

_Specificity is provided by: P( test negative – | antibodies absent ) = 0.9940_

_PPV is calculated above as TP / (TP+FP) = 0.6270016_


\newpage
**According to the CDC's Behavioral Risk Factor Surveillance System (BRFSS), about 60% of American adults live a sedentary lifestyle.**
  
**Noting that random sampling gives us independent observations, you randomly select 10 adults from this population. Calculate the following probabilities.**
  
**13. [1 point] The probability that all 10 have a sedentary lifestyle.**

Can use Binomial Dist to model this, as pop of USA is a finite size.  p=0.60

```{r}
p13 <- NULL # YOUR CODE HERE
p13 = dbinom(10,10,0.60)
p13


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p13.R")
```
  
\newpage
**14. [1 point] The probability that at least one does not have a sedentary lifestyle.**

at least one does not have sedentary lifestyle
can be reframed as only up to 9 have sedendary lifestyle, thus:

```{r}
p14 <- NULL # YOUR CODE HERE
p14 = pbinom(9,10,0.60)
p14


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p14.R")
```

\newpage

### Section 2: Normal Distribution

Part 2 of this lab introduces the normal distribution.

Notation reminder: Baldi and Moore use a compact notation for specifying that a population has a distribution that follows a normal curve with mean $\mu$ and standard deviation $\sigma$ : N( $\mu$ , $\sigma$ )

R Functions Reminder: `qnorm` takes a probability as its input and gives back a value on the distribution (aka a z-score if the distribution is N(0,1)). By default, it assumes the probability area you enter (as a decimal, not a percent) is the area below (or less than) the z score you need.  The `pnorm` function takes a z value or an X value as its input and gives back a probability area. 

**Z scores: From Baldi and Moore, 3E question 11.27, 4E question 11.29.**
Use R to find the standardized value z that satisfies each of the following conditions. In each case, sketch a standard Normal curve with your value of z marked on the axis. You do not have to attach your diagrams. 

\newpage

**15. [1 point]	The probability that a randomly selected observation falls below z is 0.8.** 

```{r}
p15 <- qnorm(0.8)
p15


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p15.R")
```

\newpage 

**16. [1 point]	The probability that a randomly selected observation falls above z is 0.35.** 

```{r}
p16 =  qnorm(0.35, lower.tail=FALSE)
p16


# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p16.R")
```

**Full-Term Birth Weights (From Baldi and Moore, 3E question 11.31, 4E question 11.33).**

For babies born at full term (37 to 39 completed weeks of gestation), the distribution of birth weight (in grams) is approximately normally distributed with a mean of 3350 grams and a standard deviation of 440 grams, N(3350,440).

**17. [1 point] What is the 25th percentile of the birthweights for full term babies?** 

```{r}
p17 = qnorm(.25,mean=3350,sd=440)
p17

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p17.R")
```

**18. [1 point] What is the 90th percentile of the birthweights for full term babies?**

```{r}
p18 <- NULL # YOUR CODE HERE
p18 = qnorm(.9,mean=3350,sd=440)

p18

# YOUR CODE HERE
``` 

```{r}
. = ottr::check("tests/p18.R")
```

**19. [1 point] What is the range of the middle 50% of birthweights for full term babies? Write this as a vector containing two values to indicate the lowerbound and upperbound of the middle 50%.**

```{r}
p19 <- NULL # YOUR CODE HERE
p19 = c(qnorm(.25,mean=3350,sd=440),qnorm(.75,mean=3350,sd=440))

p19

# YOUR CODE HERE
``` 

```{r}
. = ottr::check("tests/p19.R")
```


**Newborn Respirations (from Baldi and Moore, 3E questions 11.15-11.17, 4E question 11.17-11.19).**

**20. [1 point] The respiratory rate per minute in newborns varies according to a distribution that is approximately Normal with mean 50 and standard deviation 5. Calculate the probability that a randomly chosen newborn has a respiratory rate of 55 breaths or more per minute (convert to a percentage and round to two decimal places).**

```{r}
p20 <- NULL # YOUR CODE HERE
p20 = pnorm(55,mean=50,sd=5,lower.tail=FALSE)
p20 = round(p20*100,2)
p20
# YOUR CODE HERE
``` 

```{r}
. = ottr::check("tests/p20.R")
```

**21. [1 point] Calculate the probability that a randomly chosen newborn has a respiratory rate between 40 and 55 breaths per minute (convert to a percentage and round to two decimal places).**

```{r}
p21 <- NULL # YOUR CODE HERE

left  = pnorm(40,mean=50,sd=5)
right = pnorm(55,mean=50,sd=5,lower.tail=FALSE)
p21 = 1 - left - right
p21 = round(p21*100,2)

p21

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p21.R")
```


**Drosophila (From Baldi and Moore, 3E questions 11.20 and 11.22, 4E question 11.23)**
The common fruit fly, Drosophila melanogaster, is the most studied organism in genetic research because it is small, easy to grow, and reproduces rapidly. The length of the thorax (where the wings and legs attach) in a population of male fruit flies is approximately Normal with mean 0.800 millimeters (mm) and standard deviation 0.078 mm.

**22. [1 point] Choose a male fruit fly at random. Calculate the probability that the fly you choose has a thorax longer than 1 mm (convert to a percentage and round to two decimal places).**

```{r}
p22 <- NULL # YOUR CODE HERE
p22 = pnorm(1,mean=.800,sd=.078,lower.tail = FALSE)
p22 = round(p22*100,2)
p22

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p22.R")
```

## Questions 23-29 are ADDITIONAL PRACTICE - not for credit!

**Late Pre-Term Birth Weights (From Baldi and Moore, 3E question 11.32, 4E question 11.34)** 

How much of a difference do a couple of weeks make for birthweight? Late-preterm babies are born with 35 to 37 weeks of completed gestation. The distribution of birth weight (in grams) or late preterm babies is approximately normally distributed with a mean of 2750 grams and a standard deviation of 560 grams, N(2750,560).

**23. What is the 25th percentile of birthweights for late-preterm babies?** 

```{r}
p23 <- NULL # YOUR CODE HERE
p23 = qnorm(0.25,mean=2750,sd=560)
p23

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p23.R")
```

**24. What is the 90th percentile of the birthweights for late-preterm babies?**

```{r}
p24 <- NULL # YOUR CODE HERE
p24 = qnorm(0.90,mean=2750,sd=560)

p24 

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p24.R")
```

**25. What is the range of the middle 50% of birthweights for late-preterm babies? Write your answer as a vector containing the lower- and upper-bounds of the middle 50%.**

```{r}
p25 <- NULL # YOUR CODE HERE

p25 = c( qnorm(0.25,mean=2750,sd=560), qnorm(0.75,mean=2750,sd=560) )

p25 

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p25.R")
```

**26. Compare your answers to the questions about full term babies (17-19) with your answers to the questions about late-preterm babies (23-25). What do you notice?**

_the preterm babies are significantly lighter, to the point that their 75th percentile is just catching up to the lower 25th percentiler of normal term babies_

**Z-scores. (From Baldi and Moore, 3E question 11.25, 4E question 11.27)**

Use the `pnorm` function to find the proportion of observations from a standard Normal distribution that fall in each of the following regions. In each case, sketch a standard Normal curve and shade the area representing the region.You do not have to attach your diagrams.

**27. z $\le$ -2.25.**

```{r}
p27 <- NULL # YOUR CODE HERE
#p27 = -2.25-0/1
p27 = pnorm(-2.25)
p27

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p27.R")
```

**28. z $\ge$ -2.25.**

```{r}
p28 = pnorm(-2.25,lower.tail=FALSE)
p28

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p28.R")
```

**29. z > 1.77.**

```{r}
p29 <- pnorm(1.77,lower.tail=F)
p29

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p29.R")
```

**30. -2.25 < z < 1.77.**

```{r}
left = pnorm(-2.25)
right = pnorm(1.77, lower.tail=F)
p30  = 1 - left - right
p30

# YOUR CODE HERE
```

```{r}
. = ottr::check("tests/p30.R")
```

\newpage

### Submission

For assignments in this class, you'll be submitting using the **Terminal** tab in the pane below. In order for the submission to work properly, make sure that:

1. Any image files you add that are needed to knit the file are in the `src` folder and file paths are specified accordingly.
2. You **have not changed the file name** of the assignment.
3. The file knits properly.

Once you have checked these items, you can proceed to submit your assignment.

1. Click on the **Terminal** tab in the pane below.
2. Copy-paste the following line of code into the terminal and press enter.

cd; cd phw142-sp22/lab/lab05; python3 turn_in.py

3. Follow the prompts to enter your Gradescope username and password.
4. If the submission is successful, you should see "Submission successful!" appear as the output. **Check your submission on the Gradescope website to ensure that the autograder worked properly and you received credit for your correct answers. If you think the autograder is incorrectly grading your work, please post on piazza!**
5. If the submission fails, try to diagnose the issue using the error messages--if you have problems, post on Piazza under the post "Datahub Issues".

The late policy will be strictly enforced, **no matter the reason**, including submission issues, so be sure to submit early enough to have time to diagnose issues if problems arise.
